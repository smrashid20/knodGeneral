The vulnerability in the wpa_supplicant implementation of PEAP (Protected EAP) allows an attacker to bypass authentication by sending an EAP-TLV Success packet instead of starting Phase 2 authentication. This is possible when wpa_supplicant is configured to not verify the network's TLS certificate during Phase 1 authentication, and an eap_peap_decrypt vulnerability is exploited to skip Phase 2 authentication.

The root cause of this vulnerability lies in the way the EVP (Envelope) library handles cipher initialization. Specifically, the EVP library does not properly handle the case where the key length and IV length are passed as parameters during cipher initialization. This allows an attacker to manipulate the key length and IV length, effectively bypassing the authentication mechanism.

The repair addresses this issue by ensuring that the key length and IV length are properly set before the cipher initialization. This is done by adding a check for the presence of the OSSL_CIPHER_PARAM_KEYLEN and OSSL_CIPHER_PARAM_IVLEN parameters in the params structure. If these parameters are present, they are copied to a new array and passed to the EVP_CIPHER_CTX_set_params function, which sets the key length and IV length for the cipher context.

By setting the key length and IV length before cipher initialization, the repair prevents an attacker from manipulating these values and bypassing the authentication mechanism. This fix is specific to the EVP library and does not affect the FIPS (Federal Information Processing Standard) provider's internal library context, which is used in a manner that does not require this fix.

In summary, the repair addresses the vulnerability by ensuring that the key length and IV length are properly set before cipher initialization, preventing an attacker from manipulating these values and bypassing the authentication mechanism. This fix is specific to the EVP library and does not affect the FIPS provider's internal library context.